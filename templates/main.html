{% extends 'base.html' %}
{% block head %}
<link rel="stylesheet" href="{{url_for('static', filename='index.css')}}">
{% endblock %}

{% block content %}

<div id = "messaging">
  <h1>messages</h1>
  <ul id="messages">

  </ul>
  <input type="text" value="message" name="message" id="message"/>
  <input type="text" value="sendto" name="bob" id="sendto"/>
  <button onclick="sendMessage()"></button>
</div>




<script charset="utf-8">
$.notify("success!", "success");
let username = new URLSearchParams(window.location.search).get("username");
$.get("/load_all_messages", {"username": username}, function(data){
  console.log(data);
  for(let i in data){
    $("#messages").append(`<li>${JSON.stringify(data[i])}</li>`);
  }
  });
</script>


<script charset="utf-8">
function sendMessage(){
  $.get("/create_message", {"message": $("#message").val(), "username": username, "sendto": $("#sendto").val()},
  function(data){
    alert(data);
  });
}

</script>

<div class = "main-page">
  <div class = tasks id = "task-queue"></div>
  <div class = profile id = "profile"></div>
</div>


<script type="text/javascript">
  var tasks = [
  {
    "initiator": "rishi",
    "reward": 100,
    "description": "mow my grandma's lawn",
    "estimated_time": "1"
  }, {
    "initiator": "joy",
    "reward": 30,
    "description": "tutor me in math",
    "estimated_time": "1"
  },{
    "initiator": "joy",
    "reward": 30,
    "description": "tutor me in math",
    "estimated_time": "1"
  },{
    "initiator": "joy",
    "reward": 30,
    "description": "tutor me in math",
    "estimated_time": "1"
  },{
    "initiator": "joy",
    "reward": 30,
    "description": "tutor me in math",
    "estimated_time": "1"
  }
]

window.onload = function(){
  for(var i = 0; i< tasks.length; i++)
  {
    var card = document.createElement("div");
    card.className = "card";
    var linebreak = document.createElement("br");
    var initiatorText = document.createElement("h3");

    initiatorText.innerHTML = `${tasks[i].initiator}: ${tasks[i].description}`;
    initiatorText.className = "card-header";
    card.appendChild(initiatorText);
    var rewardText = document.createElement("li");
    rewardText.innerHTML = `${tasks[i].reward} time dimes for ${tasks[i].estimated_time} hour(s)`;
    rewardText.className = "list-group-item";
    card.append(rewardText);
    document.getElementById('task-queue').append(card);
    document.getElementById('task-queue').append(linebreak);
  }
  var parser = document.createElement('a');
  parser.href = window.location.href;
  var profileName = document.createElement("div");
  profileName.className = "profile-name";
  var name = parser.search.split("=");
  profileName.innerHTML = name[1];
  document.getElementById('profile').append(profileName);
}



</script>

{% endblock %}
